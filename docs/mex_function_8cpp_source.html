<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>World of Rigid Bodies (WoRB): mexFunction.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">World of Rigid Bodies (WoRB)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('mex_function_8cpp.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mexFunction.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mex_function_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**</span>
<a name="l00002"></a>00002 <span class="comment"> *  @file      mexFunction.cpp</span>
<a name="l00003"></a>00003 <span class="comment"> *  @brief     The main entry point for the WoRB MATLAB function.</span>
<a name="l00004"></a>00004 <span class="comment"> *  @author    Mikica Kocic</span>
<a name="l00005"></a>00005 <span class="comment"> *  @version   0.4</span>
<a name="l00006"></a>00006 <span class="comment"> *  @date      2012-05-14</span>
<a name="l00007"></a>00007 <span class="comment"> *  @copyright GNU Public License.</span>
<a name="l00008"></a>00008 <span class="comment"> */</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="_wo_r_b_8h.html" title="The World of Rigid Bodies (WoRB) Simulation Framework.">WoRB.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="_utilities_8h.html" title="Declarations for various GLUT utilites for a rigid body application.">Utilities.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="_wo_r_b___test_bed_8h.html" title="Definitions for the WoRB_TestBed, which encapsulates a GLUT based test-bed application based on the W...">WoRB_TestBed.h</a>&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;mex.h&quot;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="mex_wo_r_b_8h.html" title="Definitions for Matrix, Scalar, Logical and String classes which simplify access to MATLAB array obje...">mexWoRB.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00019"></a>00019 <span class="comment"></span><span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">/** Represents WoRB test-bed that can be initialized from `mexFunction` arguments.</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a><a class="code" href="class_wo_r_b___mex_function.html">00022</a> <span class="keyword">class </span><a class="code" href="class_wo_r_b___mex_function.html" title="Represents WoRB test-bed that can be initialized from mexFunction arguments.">WoRB_MexFunction</a> : <span class="keyword">public</span> <a class="code" href="class_wo_r_b___test_bed.html" title="Encapsulates a rigid body test-bed application.">WoRB_TestBed</a>
<a name="l00023"></a>00023 {<span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">    /** Holds the results returned to MATLAB.</span>
<a name="l00025"></a>00025 <span class="comment">     */</span>
<a name="l00026"></a><a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c">00026</a>     <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">public</span>:
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">    /** Default constructor. Creates an empty result matrix.</span>
<a name="l00031"></a>00031 <span class="comment">     */</span>
<a name="l00032"></a><a class="code" href="class_wo_r_b___mex_function.html#a313ffa8a6c72c495e8e58c68d5c0de0c">00032</a>     <a class="code" href="class_wo_r_b___mex_function.html#a313ffa8a6c72c495e8e58c68d5c0de0c" title="Default constructor.">WoRB_MexFunction</a> ()
<a name="l00033"></a>00033         : <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( 0, 0 )
<a name="l00034"></a>00034     {
<a name="l00035"></a>00035     }
<a name="l00036"></a>00036 <span class="comment"></span>
<a name="l00037"></a>00037 <span class="comment">    /** Initializes parameters and creates bodies from mexFunction arguments.</span>
<a name="l00038"></a>00038 <span class="comment">     * The first mex function argument should be a structure with fields as sys params.</span>
<a name="l00039"></a>00039 <span class="comment">     * The second mex function argument should be a structure array with body parameters.</span>
<a name="l00040"></a>00040 <span class="comment">      */</span>
<a name="l00041"></a><a class="code" href="class_wo_r_b___mex_function.html#a4ba3e1563aae6665affadf2f1d02c8bd">00041</a>     <span class="keywordtype">void</span> <a class="code" href="class_wo_r_b___mex_function.html#a4ba3e1563aae6665affadf2f1d02c8bd" title="Initializes parameters and creates bodies from mexFunction arguments.">Parse</a>( 
<a name="l00042"></a>00042         <span class="keywordtype">int</span> nArgIn, <span class="keyword">const</span> mxArray* argIn[] <span class="comment">// right-hand side (varargin) of the function</span>
<a name="l00043"></a>00043         )
<a name="l00044"></a>00044     {
<a name="l00045"></a>00045         <span class="keywordflow">if</span> ( nArgIn &gt;= 1 &amp;&amp; ! mxIsStruct( argIn[0] ) ) {
<a name="l00046"></a>00046             <a class="code" href="namespace_wo_r_b.html#ae24d7cce239971d803de67e67289cc5d" title="Reports a severe error (with errorId compatible with MATLAB) and quits.">WoRB::SevereError</a>( <span class="stringliteral">&quot;WoRB:Init:invarg&quot;</span>,
<a name="l00047"></a>00047                 <span class="stringliteral">&quot;The first argument must be a structure with system parameters.&quot;</span> );
<a name="l00048"></a>00048         }
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="keywordflow">if</span> ( nArgIn &gt;= 2 &amp;&amp; ! mxIsStruct( argIn[1] ) ) {
<a name="l00051"></a>00051             <a class="code" href="namespace_wo_r_b.html#ae24d7cce239971d803de67e67289cc5d" title="Reports a severe error (with errorId compatible with MATLAB) and quits.">WoRB::SevereError</a>( <span class="stringliteral">&quot;WoRB:Init:invarg&quot;</span>, 
<a name="l00052"></a>00052                 <span class="stringliteral">&quot;The second argument must be a structure array of body parameters.&quot;</span> );
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054 <span class="comment"></span>
<a name="l00055"></a>00055 <span class="comment">        /////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00056"></a>00056 <span class="comment"></span>        <span class="comment">// Clear objects from previous simulations and make default parameters.</span>
<a name="l00057"></a>00057         <span class="comment">//</span>
<a name="l00058"></a>00058             
<a name="l00059"></a>00059         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a> = <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a>( 0, 0 );  <span class="comment">// Clear earlier results</span>
<a name="l00060"></a>00060         <a class="code" href="class_wo_r_b___test_bed.html#a2a562a62e7657521c2554bd02033d2d2" title="Delayed constructor; after all static members are initialized.">Initialize</a> ();                 <span class="comment">// Initialize default parameters</span>
<a name="l00061"></a>00061         <a class="code" href="class_wo_r_b___test_bed.html#a51218f0aadee04d6a339fb018fdede72" title="Clears the current simulation data and prepares a new simulation.">ClearTestBed</a> ();               <span class="comment">// Clear existing simulation, if any.</span>
<a name="l00062"></a>00062 <span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">        /////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00064"></a>00064 <span class="comment"></span>        <span class="comment">// Parse params structure</span>
<a name="l00065"></a>00065         <span class="comment">//</span>
<a name="l00066"></a>00066         <span class="keywordtype">bool</span> dumpInitialState = <span class="keyword">false</span>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="keywordflow">if</span> ( nArgIn &gt;= 1 )  
<a name="l00069"></a>00069         {
<a name="l00070"></a>00070             <span class="keyword">const</span> mxArray* params = argIn[0];
<a name="l00071"></a>00071 
<a name="l00072"></a>00072             <a class="code" href="class_wo_r_b___test_bed.html#a505c1d7c9b44fed7809ec9c5a295e22f" title="Holds window title.">WindowTitle</a> = <a class="code" href="class_mex_1_1_string.html" title="Represents a MATLAB character string value.">Mex::String</a>( params, 0, <span class="stringliteral">&quot;Title&quot;</span> );
<a name="l00073"></a>00073 
<a name="l00074"></a>00074             <a class="code" href="class_wo_r_b___test_bed.html#a16ff3c1401f82d717e029094061e4d47" title="Holds next requested configuration profile.">TestSuite</a>            = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;TestSuite&quot;</span>          );
<a name="l00075"></a>00075             <a class="code" href="class_wo_r_b___test_bed.html#a7f2504768e73ee3b720ff598baeda4a2" title="Indicates whether the instance is properly constructed.">IsInitialized</a>        = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;IsInitialized&quot;</span>      );
<a name="l00076"></a>00076             <a class="code" href="class_wo_r_b___test_bed.html#ae3d27d275824b2ed12ea0407b186beb5" title="Indicates whether the application is running.">IsRunning</a>            = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;IsRunning&quot;</span>          );
<a name="l00077"></a>00077             <a class="code" href="class_wo_r_b___test_bed.html#a3c8766c52e60357dc97d55a52381f1f8" title="Indicates whether the simulation is running (alternative to being paused).">IsPaused</a>             = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;IsPaused&quot;</span>           );
<a name="l00078"></a>00078             <a class="code" href="class_wo_r_b___test_bed.html#a5bd98b1c461393d9cf1439b56e009898" title="Indicates whether the simulation halts after every time-step.">AutoPause</a>            = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;AutoPause&quot;</span>          );
<a name="l00079"></a>00079             <a class="code" href="class_wo_r_b___test_bed.html#a5a857faef83e4baba5a251007117faf0" title="Indicates whether to display objects in wireframe.">Wireframe</a>            = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;Wireframe&quot;</span>          );
<a name="l00080"></a>00080             <a class="code" href="class_wo_r_b___test_bed.html#a381f695149fddca2f6e6dbc8887f1c86" title="Indicates whether to display axes of the rigid bodies.">ShowBodyAxes</a>         = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;ShowBodyAxes&quot;</span>       );
<a name="l00081"></a>00081             <a class="code" href="class_wo_r_b___test_bed.html#a07c6bd9eb2e7b1ab608cffa51ab570fb" title="Indicates whether to show objects mirrored in the floor.">ShowFloorMirror</a>      = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;ShowFloorMirror&quot;</span>    );
<a name="l00082"></a>00082             <a class="code" href="class_wo_r_b___test_bed.html#acf037fae1f9fdb1cd7d4f4cd49097e12" title="Indicates whether to display contact normals.">ShowContacts</a>         = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;ShowContacts&quot;</span>       );
<a name="l00083"></a>00083             <a class="code" href="class_wo_r_b___test_bed.html#a3fb6b7937faf6a93f2402396ca0b7967" title="Indicates whether to display trajectories.">ShowTrajectories</a>     = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;ShowTrajectories&quot;</span>   );
<a name="l00084"></a>00084             <a class="code" href="class_wo_r_b___test_bed.html#a7d7e91831187edcb2b646645a06b72d1" title="Indicates whether to display the system state variables.">ShowStateVariables</a>   = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;ShowStateVariables&quot;</span> );
<a name="l00085"></a>00085             <a class="code" href="class_wo_r_b___test_bed.html#aa0d86c609061827f3e339d7ef52a6d71" title="Indicates whether to display help info.">ShowHelp</a>             = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;ShowHelp&quot;</span>           );
<a name="l00086"></a>00086             dumpInitialState     = <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a>( params, 0, <span class="stringliteral">&quot;DumpInitialState&quot;</span>   );
<a name="l00087"></a>00087 
<a name="l00088"></a>00088             <a class="code" href="class_wo_r_b___test_bed.html#a05e533b816e65b753a55c01295b1d4cd" title="Holds the length of a single tick in the system grid.">GridTickLength</a> = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;GridTickLength&quot;</span> );
<a name="l00089"></a>00089             <a class="code" href="class_wo_r_b___test_bed.html#a23e4af3f41177750a6a62bb80e1f36b7" title="Holds the number of the ticks in the system grid (bounded by the walls).">GridTicks</a>      = int( <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;GridTicks&quot;</span> ) );
<a name="l00090"></a>00090 
<a name="l00091"></a>00091             <a class="code" href="class_wo_r_b___test_bed.html#a703862a8d91cf568d70e681dd7b81bc7" title="Holds integrator time-step length, in seconds.">TimeStep</a>             = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;TimeStep&quot;</span> );
<a name="l00092"></a>00092             <a class="code" href="class_wo_r_b___test_bed.html#a399393efac17bc34629567082dfeece4" title="Holds number of integrator time-steps solved per one video frame.">TimeStepsPerFrame</a>    = unsigned( <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;TimeStepsPerFrame&quot;</span> ) );
<a name="l00093"></a>00093             <a class="code" href="class_wo_r_b___test_bed.html#ade096d6b734db4316d56c06b773c7af4" title="Holds number of integrator time-steps solved per one trajectory snapshot.">TimeStepsPerSnapshot</a> = unsigned( <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;TimeStepsPerSnapshot&quot;</span> ) );
<a name="l00094"></a>00094 
<a name="l00095"></a>00095             <a class="code" href="class_wo_r_b___test_bed.html#aeae28e807695b7b010cf1bf01e84b98f" title="Holds the camera angle (phi).">CameraAngle</a>      = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;CameraAngle&quot;</span>     );
<a name="l00096"></a>00096             <a class="code" href="class_wo_r_b___test_bed.html#af4a63b243a5cc501bf29b2978abffed8" title="Holds the camera elevation (theta).">CameraElevation</a>  = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;CameraElevation&quot;</span> );
<a name="l00097"></a>00097             <a class="code" href="class_wo_r_b___test_bed.html#a3450f64d3f032c3e5be7298ac839daeb" title="Holds the camera zoom (distance from the look-at point).">CameraZoom</a>       = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;CameraZoom&quot;</span>      );
<a name="l00098"></a>00098 
<a name="l00099"></a>00099             <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> lookAt( params, 0, <span class="stringliteral">&quot;CameraLookAt&quot;</span> );
<a name="l00100"></a>00100             lookAt.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 3, <span class="stringliteral">&quot;CameraLookAt must be a spatial vector&quot;</span> );
<a name="l00101"></a>00101             <a class="code" href="class_wo_r_b___test_bed.html#a3c680abadf1bf5c5fa02db0229b598c1" title="Holds the point camera looks at.">CameraLookAt</a> = <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( lookAt(0), lookAt(1), lookAt(2) );
<a name="l00102"></a>00102 
<a name="l00103"></a>00103             <a class="code" href="class_wo_r_b___test_bed.html#a04a347063c04ae2189613e4c2c598c06" title="Holds the index of an object that is followed by the camera view.">FollowObject</a> = unsigned( <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;FollowObject&quot;</span> ) );
<a name="l00104"></a>00104             <a class="code" href="class_wo_r_b___test_bed.html#a39c848a9e17fe35e044642fae16d9a75" title="Final simulation time, s.">FinalTime</a>    = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;FinalTime&quot;</span> );
<a name="l00105"></a>00105 
<a name="l00106"></a>00106             <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a90aa2f8ff07e2a69edc2920085111c10" title="Holds the collision data for all registered collisions.">Collisions</a>.<a class="code" href="class_wo_r_b_1_1_collision_resolver.html#aedb0cf7218f37aea60729e49d849d104" title="Holds the restitution coefficient common for all collisions.">Restitution</a> = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;Restitution&quot;</span> );
<a name="l00107"></a>00107             <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a90aa2f8ff07e2a69edc2920085111c10" title="Holds the collision data for all registered collisions.">Collisions</a>.<a class="code" href="class_wo_r_b_1_1_collision_resolver.html#a60af051a934963ec40318771532f544a" title="Holds the position projections coefficient common for all collisions.">Relaxation</a>  = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;Relaxation&quot;</span>  );
<a name="l00108"></a>00108             <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a90aa2f8ff07e2a69edc2920085111c10" title="Holds the collision data for all registered collisions.">Collisions</a>.<a class="code" href="class_wo_r_b_1_1_collision_resolver.html#a36e36fd2a04401689635e322ee40d1e0" title="Holds the friction coefficient common for all collisions.">Friction</a>    = <a class="code" href="class_mex_1_1_scalar.html" title="Represents a MATLAB scalar double value.">Mex::Scalar</a>( params, 0, <span class="stringliteral">&quot;Friction&quot;</span>    );
<a name="l00109"></a>00109 
<a name="l00110"></a>00110             <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> G( params, 0, <span class="stringliteral">&quot;Gravity&quot;</span> );
<a name="l00111"></a>00111             G.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 3, <span class="stringliteral">&quot;Gravity must be a spatial vector&quot;</span> );
<a name="l00112"></a>00112             <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a37789094e753f003517b0e4b6b423bd9" title="Holds common gravity applied to all objects (set to 0 to disable).">Gravity</a> = <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( G(0), G(1), G(2) );
<a name="l00113"></a>00113         }
<a name="l00114"></a>00114 <span class="comment"></span>
<a name="l00115"></a>00115 <span class="comment">        /////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00116"></a>00116 <span class="comment"></span>        <span class="comment">// Parse bodies array structure</span>
<a name="l00117"></a>00117         <span class="comment">//</span>
<a name="l00118"></a>00118         <span class="keywordflow">if</span> ( nArgIn &gt;= 2 )
<a name="l00119"></a>00119         {
<a name="l00120"></a>00120             <span class="keyword">const</span> mxArray* body = argIn[1];
<a name="l00121"></a>00121             <span class="keywordtype">unsigned</span> bodyCount = unsigned( mxGetNumberOfElements( body ) );
<a name="l00122"></a>00122 
<a name="l00123"></a>00123             <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> i = 0; i &lt; bodyCount; ++i )
<a name="l00124"></a>00124             {
<a name="l00125"></a>00125                 <a class="code" href="class_mex_1_1_string.html" title="Represents a MATLAB character string value.">Mex::String</a> geometry( body, i, <span class="stringliteral">&quot;Geometry&quot;</span> ); <span class="comment">// Geometry class</span>
<a name="l00126"></a>00126                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> R( body, i, <span class="stringliteral">&quot;HalfExtent&quot;</span> ); <span class="comment">// Radius or half-extent</span>
<a name="l00127"></a>00127                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> M( body, i, <span class="stringliteral">&quot;M&quot;</span> ); <span class="comment">// Body mass</span>
<a name="l00128"></a>00128                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> X( body, i, <span class="stringliteral">&quot;X&quot;</span> ); <span class="comment">// Position</span>
<a name="l00129"></a>00129                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> Q( body, i, <span class="stringliteral">&quot;Q&quot;</span> ); <span class="comment">// Oritentation</span>
<a name="l00130"></a>00130                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> V( body, i, <span class="stringliteral">&quot;V&quot;</span> ); <span class="comment">// Velocity</span>
<a name="l00131"></a>00131                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> W( body, i, <span class="stringliteral">&quot;W&quot;</span> ); <span class="comment">// Angular velocity</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133                 <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a> showTrajectory   ( body, i, <span class="stringliteral">&quot;ShowTrajectory&quot;</span>,   <span class="keyword">true</span>  );
<a name="l00134"></a>00134                 <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a> isActive         ( body, i, <span class="stringliteral">&quot;CanBeDeactivated&quot;</span>, <span class="keyword">true</span>  );
<a name="l00135"></a>00135                 <a class="code" href="class_mex_1_1_logical.html" title="Represents a MATLAB logical value.">Mex::Logical</a> canBeDeactivated ( body, i, <span class="stringliteral">&quot;CanBeDeactivated&quot;</span>, <span class="keyword">false</span> );
<a name="l00136"></a>00136 
<a name="l00137"></a>00137                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> cActive  ( body, i, <span class="stringliteral">&quot;ActiveColor&quot;</span>   ); <span class="comment">// Active color</span>
<a name="l00138"></a>00138                 <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a> cInactive( body, i, <span class="stringliteral">&quot;InactiveColor&quot;</span> ); <span class="comment">// Inactive color</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                 <span class="comment">// Verify dimensions of body parameters</span>
<a name="l00141"></a>00141                 <span class="comment">//</span>
<a name="l00142"></a>00142                 M.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 1, <span class="stringliteral">&quot;Mass must be a scalar&quot;</span> );
<a name="l00143"></a>00143                 X.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 3, <span class="stringliteral">&quot;Position must be a spatial vector&quot;</span> );
<a name="l00144"></a>00144                 Q.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 4, <span class="stringliteral">&quot;Orientation must be a quaternion&quot;</span> );
<a name="l00145"></a>00145                 V.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 3, <span class="stringliteral">&quot;Velocity must be a spatial vector&quot;</span> );
<a name="l00146"></a>00146                 W.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 3, <span class="stringliteral">&quot;Angular velocity must be a spatial vector&quot;</span> );
<a name="l00147"></a>00147 
<a name="l00148"></a>00148                 <span class="comment">// Create rigid bodies with geometries given by parameters</span>
<a name="l00149"></a>00149                 <span class="comment">//</span>
<a name="l00150"></a>00150                 <a class="code" href="class_wo_r_b_1_1_g_l_u_t___renderer.html" title="Interface for a GLUT-rendered rigid body.">WoRB::GLUT_Renderer</a>* obj = NULL;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152                 <span class="keywordflow">if</span> ( geometry == <span class="stringliteral">&quot;cuboid&quot;</span> )
<a name="l00153"></a>00153                 {
<a name="l00154"></a>00154                     R.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 3,
<a name="l00155"></a>00155                         <span class="stringliteral">&quot;Half-extent of a cuboid must be a spatial vector&quot;</span> );
<a name="l00156"></a>00156 
<a name="l00157"></a>00157                     obj = <span class="keyword">new</span> <a class="code" href="class_wo_r_b_1_1_box.html" title="Encapsulates a rigid body with geometry of a rectangular parallelepiped.">WoRB::Box</a>(
<a name="l00158"></a>00158                         <span class="comment">/* position      */</span> <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( X(0), X(1), X(2) ), 
<a name="l00159"></a>00159                         <span class="comment">/* orientation   */</span> <a class="code" href="class_wo_r_b_1_1_quaternion.html" title="Encapsulates Hamilton real quaternions.">WoRB::Quaternion</a>   ( Q(0), Q(1), Q(2), Q(3) ),
<a name="l00160"></a>00160                         <span class="comment">/* velocity      */</span> <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( V(0), V(1), V(2) ), 
<a name="l00161"></a>00161                         <span class="comment">/* ang. velocity */</span> <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( W(0), W(1), W(2) ),
<a name="l00162"></a>00162                         <span class="comment">/* half-extent   */</span> <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( R(0), R(1), R(2) ), 
<a name="l00163"></a>00163                         <span class="comment">/* mass          */</span> M(0)
<a name="l00164"></a>00164                     );
<a name="l00165"></a>00165                 }
<a name="l00166"></a>00166                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( geometry == <span class="stringliteral">&quot;sphere&quot;</span> )
<a name="l00167"></a>00167                 {
<a name="l00168"></a>00168                     R.<a class="code" href="class_mex_1_1_matrix.html#a2bf05638f2adf75e992b04f038c2f757" title="Verifies sizes of each matrix dimension.">VerifyDims</a>( 1, 1,
<a name="l00169"></a>00169                         <span class="stringliteral">&quot;Half-extent i.e. radius of a sphere must be a scalar&quot;</span> );
<a name="l00170"></a>00170 
<a name="l00171"></a>00171                     obj = <span class="keyword">new</span> <a class="code" href="class_wo_r_b_1_1_ball.html" title="Encapsulates a rigid body with geometry of a sphere.">WoRB::Ball</a>(
<a name="l00172"></a>00172                         <span class="comment">/* position      */</span> <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( X(0), X(1), X(2) ), 
<a name="l00173"></a>00173                         <span class="comment">/* orientation   */</span> <a class="code" href="class_wo_r_b_1_1_quaternion.html" title="Encapsulates Hamilton real quaternions.">WoRB::Quaternion</a>   ( Q(0), Q(1), Q(2), Q(3) ),
<a name="l00174"></a>00174                         <span class="comment">/* velocity      */</span> <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( V(0), V(1), V(2) ), 
<a name="l00175"></a>00175                         <span class="comment">/* ang. velocity */</span> <a class="code" href="class_wo_r_b_1_1_spatial_vector.html" title="Encapsulates a spatial vector.">WoRB::SpatialVector</a>( W(0), W(1), W(2) ),
<a name="l00176"></a>00176                         <span class="comment">/* radius        */</span> R(0), 
<a name="l00177"></a>00177                         <span class="comment">/* mass          */</span> M(0)
<a name="l00178"></a>00178                     );
<a name="l00179"></a>00179                 }
<a name="l00180"></a>00180                 <span class="keywordflow">else</span> {
<a name="l00181"></a>00181                     <a class="code" href="namespace_wo_r_b.html#ae24d7cce239971d803de67e67289cc5d" title="Reports a severe error (with errorId compatible with MATLAB) and quits.">WoRB::SevereError</a>( <span class="stringliteral">&quot;WoRB:Init:invarg&quot;</span>, 
<a name="l00182"></a>00182                         <span class="stringliteral">&quot;Invalid body(%u) type &#39;%s&#39;; &quot;</span>
<a name="l00183"></a>00183                         <span class="stringliteral">&quot;allowed types are &#39;cuboid&#39; or &#39;sphere&#39;.&quot;</span>,
<a name="l00184"></a>00184                         i, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)geometry );
<a name="l00185"></a>00185                 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                 <span class="comment">// Optional trajectory flag</span>
<a name="l00188"></a>00188                 <span class="comment">//</span>
<a name="l00189"></a>00189                 obj-&gt;<a class="code" href="class_wo_r_b_1_1_g_l_u_t___renderer.html#a2f42fd98e1430231a75d2c5d9529eb2a" title="Indicates whether to track objects trajectory.">ShowTrajectory</a> = showTrajectory;
<a name="l00190"></a>00190                 obj-&gt;<a class="code" href="class_wo_r_b_1_1_g_l_u_t___renderer.html#ace5b8a44158af99f4de597e7dc1da215" title="Gets underlying rigid body.">GetBody</a>().<a class="code" href="class_wo_r_b_1_1_rigid_body.html#a3bd43e0c1a1b6c676feeb617f63302f0" title="Sets whether the body is ever allowed to be deactivated.">SetCanBeDeactivated</a>( canBeDeactivated );
<a name="l00191"></a>00191                 <span class="keywordflow">if</span> ( ! isActive ) {
<a name="l00192"></a>00192                     obj-&gt;<a class="code" href="class_wo_r_b_1_1_g_l_u_t___renderer.html#ace5b8a44158af99f4de597e7dc1da215" title="Gets underlying rigid body.">GetBody</a>().<a class="code" href="class_wo_r_b_1_1_rigid_body.html#ab4fb04d73398750b7865f64421264146" title="Disallows body to move i.e.">Deactivate</a> ();
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195                 <span class="comment">// Optional active color</span>
<a name="l00196"></a>00196                 <span class="comment">//</span>
<a name="l00197"></a>00197                 <span class="keywordflow">if</span> ( cActive.<a class="code" href="class_mex_1_1_matrix.html#a93967d6c23601fa749997c3c2f98bc0b" title="Checks the sizes of each dimension of the matrix.">IsSize</a>( 1, 4 ) ) {
<a name="l00198"></a>00198                     obj-&gt;<a class="code" href="class_wo_r_b_1_1_g_l_u_t___renderer.html#ab41334b7f0ade9014c9a1f3fcc11df2f" title="Holds the shape color, used when body is active (moving).">ActiveColor</a> = <a class="code" href="struct_wo_r_b_1_1_g_l_u_t___renderer_1_1_colorf.html" title="Represents a color defined red, green, blue and alpha channels.">WoRB::GLUT_Renderer::Colorf</a>( 
<a name="l00199"></a>00199                         cActive(0), cActive(1), cActive(2), cActive(3)
<a name="l00200"></a>00200                     );
<a name="l00201"></a>00201                 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                 <span class="comment">// Optional inactive color</span>
<a name="l00204"></a>00204                 <span class="comment">//</span>
<a name="l00205"></a>00205                 <span class="keywordflow">if</span> ( cInactive.<a class="code" href="class_mex_1_1_matrix.html#a93967d6c23601fa749997c3c2f98bc0b" title="Checks the sizes of each dimension of the matrix.">IsSize</a>( 1, 4 ) ) {
<a name="l00206"></a>00206                     obj-&gt;<a class="code" href="class_wo_r_b_1_1_g_l_u_t___renderer.html#a611110a443a3511aa15f1bd7730e7bf0" title="Holds the shape color, used when body is inactive (not-moving).">InactiveColor</a> = <a class="code" href="struct_wo_r_b_1_1_g_l_u_t___renderer_1_1_colorf.html" title="Represents a color defined red, green, blue and alpha channels.">WoRB::GLUT_Renderer::Colorf</a>( 
<a name="l00207"></a>00207                         cInactive(0), cInactive(1), cInactive(2), cInactive(3)
<a name="l00208"></a>00208                     );
<a name="l00209"></a>00209                 }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                 <span class="comment">// Add objects to the list</span>
<a name="l00212"></a>00212                 <span class="comment">//</span>
<a name="l00213"></a>00213                 <a class="code" href="class_wo_r_b___test_bed.html#a6b8c3da2a2ee7c28d0bfe3fecdff9938" title="Holds the collection of all rendered rigid bodies in the system.">Objects</a>.push_back( obj );
<a name="l00214"></a>00214                 <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#af7a5ef9283a902c536de65d184ed6f93" title="Adds new object to the system.">Add</a>( obj-&gt;<a class="code" href="class_wo_r_b_1_1_g_l_u_t___renderer.html#a407e9eebefcf53fc944536a8cf808afa" title="Gets underlying geometry.">GetGeometry</a> () );
<a name="l00215"></a>00215             }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217             <span class="comment">// Initialize ODE (calculate derived quantities for recently added objects)</span>
<a name="l00218"></a>00218             <span class="comment">//</span>
<a name="l00219"></a>00219             <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a4d534b310ec24b1fa6da06d626fac271" title="Prepares ODE (recalculates derived quantities)">InitializeODE</a> ();
<a name="l00220"></a>00220 
<a name="l00221"></a>00221             <span class="comment">// Clear test-suite configuration request since we&#39;ve configured test-bed.</span>
<a name="l00222"></a>00222             <span class="comment">//</span>
<a name="l00223"></a>00223             <a class="code" href="class_wo_r_b___test_bed.html#a16ff3c1401f82d717e029094061e4d47" title="Holds next requested configuration profile.">TestSuite</a> = -1;
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225 <span class="comment"></span>
<a name="l00226"></a>00226 <span class="comment">        /////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00227"></a>00227 <span class="comment"></span>        <span class="comment">// Report parameters and bodies that we have so far.</span>
<a name="l00228"></a>00228         <span class="comment">//</span>
<a name="l00229"></a>00229         <span class="keywordflow">if</span> ( dumpInitialState )
<a name="l00230"></a>00230         {
<a name="l00231"></a>00231             <a class="code" href="class_wo_r_b___test_bed.html#a44703080ea5202b1949a0f275729f702" title="Dumps all parameter values using Printf().">Dump</a> (); 
<a name="l00232"></a>00232             <a class="code" href="namespace_wo_r_b.html#a1daf5df6226659812376d1cd23aa6d89" title="User defined ANSI C printf-style output routine.">WoRB::Printf</a>( <span class="stringliteral">&quot;\n&quot;</span> );
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235 <span class="comment"></span>
<a name="l00236"></a>00236 <span class="comment">    /** Gets the result matrix.</span>
<a name="l00237"></a>00237 <span class="comment">     */</span>
<a name="l00238"></a><a class="code" href="class_wo_r_b___mex_function.html#ac977f589a7929abe7bec2cf285bd3035">00238</a>     mxArray* <a class="code" href="class_wo_r_b___mex_function.html#ac977f589a7929abe7bec2cf285bd3035" title="Gets the result matrix.">GetResult</a> ()
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240         <span class="keywordflow">return</span> <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>;
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242 <span class="comment"></span>
<a name="l00243"></a>00243 <span class="comment">    /** Creates the result matrix.</span>
<a name="l00244"></a>00244 <span class="comment">     */</span>
<a name="l00245"></a><a class="code" href="class_wo_r_b___mex_function.html#afbf5725c24de78d6b99466b1e8a18a3a">00245</a>     <span class="keywordtype">void</span> <a class="code" href="class_wo_r_b___mex_function.html#afbf5725c24de78d6b99466b1e8a18a3a" title="Creates the result matrix.">CreateResultMatrix</a> ()
<a name="l00246"></a>00246     {
<a name="l00247"></a>00247         <span class="comment">// Ensure to have have a finite number of recorded time-steps</span>
<a name="l00248"></a>00248         <span class="comment">//</span>
<a name="l00249"></a>00249         <span class="keywordflow">if</span> ( <a class="code" href="class_wo_r_b___test_bed.html#a39c848a9e17fe35e044642fae16d9a75" title="Final simulation time, s.">FinalTime</a> == 0 ) {
<a name="l00250"></a>00250             <span class="keywordflow">return</span>;  
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordtype">unsigned</span> n_steps = unsigned( <a class="code" href="class_wo_r_b___test_bed.html#a39c848a9e17fe35e044642fae16d9a75" title="Final simulation time, s.">FinalTime</a> / <a class="code" href="class_wo_r_b___test_bed.html#a703862a8d91cf568d70e681dd7b81bc7" title="Holds integrator time-step length, in seconds.">TimeStep</a> ) + 1;
<a name="l00254"></a>00254         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a> = <a class="code" href="class_mex_1_1_matrix.html" title="Represents a simple matrix class that keeps components in a column-major order.">Mex::Matrix</a>( n_steps, 11 );
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="comment">// Set &#39;time&#39; column to NaN (indicating row do not have valid data yet).</span>
<a name="l00257"></a>00257         <span class="comment">//</span>
<a name="l00258"></a>00258         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> i = 0; i &lt; n_steps; ++i ) {
<a name="l00259"></a>00259             <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( i, 0 ) = mxGetNaN ();
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         <a class="code" href="namespace_wo_r_b.html#a1daf5df6226659812376d1cd23aa6d89" title="User defined ANSI C printf-style output routine.">WoRB::Printf</a>( <span class="stringliteral">&quot;WoRB: Created matrix for results [ %d × %d ]\n&quot;</span>, 
<a name="l00263"></a>00263             <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>.<a class="code" href="class_mex_1_1_matrix.html#a3fe0394f5e428c5970723b5ebbbc2ad3" title="Gets the number of rows in the matrix.">GetM</a> (), <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>.<a class="code" href="class_mex_1_1_matrix.html#a5ccb2d244de35965700e8833395411a0" title="Gets the number of columns in the matrix.">GetN</a> () );
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 <span class="comment"></span>
<a name="l00266"></a>00266 <span class="comment">    /** Saves simulated data to be returned to MATLAB as the result.</span>
<a name="l00267"></a>00267 <span class="comment">     */</span>
<a name="l00268"></a><a class="code" href="class_wo_r_b___mex_function.html#ad3f353547ac909864ff1c9c5930e9ba4">00268</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_wo_r_b___mex_function.html#ad3f353547ac909864ff1c9c5930e9ba4" title="Saves simulated data to be returned to MATLAB as the result.">OnProcessData</a> ()
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270         <span class="keywordflow">if</span> ( <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>.<a class="code" href="class_mex_1_1_matrix.html#a364cffd623e65efd759b01c2ea4a780e" title="Returns true if the instance is an empty array.">IsEmpty</a> () ) {
<a name="l00271"></a>00271             <span class="keywordflow">return</span>;
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="keywordtype">unsigned</span> n = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#ae7d49659d036152dabadc78bf2866d50" title="Holds the number of integrator time-steps, from the simulation start.">TimeStepCount</a>;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 0 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a3806dc769b8555c6cfdbf0426270a013" title="Holds the system local time, in s.">Time</a>;
<a name="l00277"></a>00277         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 1 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a90aa2f8ff07e2a69edc2920085111c10" title="Holds the collision data for all registered collisions.">Collisions</a>.<a class="code" href="class_wo_r_b_1_1_collision_resolver.html#a1ac686dbae0297bc06c8041b55e1e175" title="Gets number of contats in the registry.">Count</a> ();
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 2 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a11edd4ea1f345e57907e68aff44accef" title="Holds the total kinetic energy of the system, in J.">TotalKineticEnergy</a>;
<a name="l00280"></a>00280         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 3 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#ab6c23c6f8fff79da6c204cb6cad3626e" title="Holds the total potential energy of the system, in J.">TotalPotentialEnergy</a>;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 4 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a5517cffcc733a89b3b9d6ebe7af07036" title="Holds the total linear momentum of the system, in kg m^2 s^-1.">TotalLinearMomentum</a>.<a class="code" href="class_wo_r_b_1_1_quaternion.html#a28802efcda7cc375d5a45d3be1eaefc3" title="Holds i-component of the pure imaginary (vector) part.">x</a>;
<a name="l00283"></a>00283         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 5 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a5517cffcc733a89b3b9d6ebe7af07036" title="Holds the total linear momentum of the system, in kg m^2 s^-1.">TotalLinearMomentum</a>.<a class="code" href="class_wo_r_b_1_1_quaternion.html#a6f8cac6c6ca2425471915fa8a3f4197e" title="Holds j-component of the pure imaginary (vector) part.">y</a>;
<a name="l00284"></a>00284         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 6 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#a5517cffcc733a89b3b9d6ebe7af07036" title="Holds the total linear momentum of the system, in kg m^2 s^-1.">TotalLinearMomentum</a>.<a class="code" href="class_wo_r_b_1_1_quaternion.html#ac8db915c9c1fd87c962bc540731011f4" title="Holds k-component of the pure imaginary (vector) part.">z</a>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 7 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#ae621af15bf05315aadffe32c6041c516" title="Holds the total angular momentum of the system, in kg m^2 s^-1.">TotalAngularMomentum</a>.<a class="code" href="class_wo_r_b_1_1_quaternion.html#a28802efcda7cc375d5a45d3be1eaefc3" title="Holds i-component of the pure imaginary (vector) part.">x</a>;
<a name="l00287"></a>00287         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 8 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#ae621af15bf05315aadffe32c6041c516" title="Holds the total angular momentum of the system, in kg m^2 s^-1.">TotalAngularMomentum</a>.<a class="code" href="class_wo_r_b_1_1_quaternion.html#a6f8cac6c6ca2425471915fa8a3f4197e" title="Holds j-component of the pure imaginary (vector) part.">y</a>;
<a name="l00288"></a>00288         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 9 ) = <a class="code" href="class_wo_r_b___test_bed.html#abd60cc8ff8ceb0616631378cbbe428ee" title="Holds the WoRB physics simulation framework.">worb</a>.<a class="code" href="class_wo_r_b_1_1_world_of_rigid_bodies.html#ae621af15bf05315aadffe32c6041c516" title="Holds the total angular momentum of the system, in kg m^2 s^-1.">TotalAngularMomentum</a>.<a class="code" href="class_wo_r_b_1_1_quaternion.html#ac8db915c9c1fd87c962bc540731011f4" title="Holds k-component of the pure imaginary (vector) part.">z</a>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <a class="code" href="class_wo_r_b___mex_function.html#acb8552fe8a0ec88c26d1d81c068d389c" title="Holds the results returned to MATLAB.">Result</a>( n, 10 ) = <a class="code" href="class_wo_r_b___test_bed.html#a6b8c3da2a2ee7c28d0bfe3fecdff9938" title="Holds the collection of all rendered rigid bodies in the system.">Objects</a>.size () == 0 ? 0.0
<a name="l00291"></a>00291             : <a class="code" href="class_wo_r_b___test_bed.html#a6b8c3da2a2ee7c28d0bfe3fecdff9938" title="Holds the collection of all rendered rigid bodies in the system.">Objects</a>.at( <a class="code" href="class_wo_r_b___test_bed.html#a6b8c3da2a2ee7c28d0bfe3fecdff9938" title="Holds the collection of all rendered rigid bodies in the system.">Objects</a>.size() - 1 )-&gt;GetBody().Position.y;
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293 };
<a name="l00294"></a>00294 <span class="comment"></span>
<a name="l00295"></a>00295 <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00296"></a>00296 <span class="comment"></span><span class="comment"></span>
<a name="l00297"></a>00297 <span class="comment">/** Definition of the static instance wrapper for our GLUT application.</span>
<a name="l00298"></a>00298 <span class="comment"> */</span>
<a name="l00299"></a>00299 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; 
<a name="l00300"></a>00300 T* <a class="code" href="class_wo_r_b_1_1_g_l_u_t___framework.html" title="GLUT wrapper around a single instance of a GlutApplication template class.">WoRB::GLUT_Framework&lt;T&gt;::Application</a> = 0;
<a name="l00301"></a>00301 
<a name="l00302"></a><a class="code" href="mex_function_8cpp.html#aac04beabf71bbc53d7d102e146b02349">00302</a> <span class="keyword">static</span> <a class="code" href="class_wo_r_b___mex_function.html" title="Represents WoRB test-bed that can be initialized from mexFunction arguments.">WoRB_MexFunction</a> <a class="code" href="mex_function_8cpp.html#aac04beabf71bbc53d7d102e146b02349">Application</a>;
<a name="l00303"></a><a class="code" href="mex_function_8cpp.html#ac74b9d22312f8540dd4e58292aca7a8b">00303</a> <span class="keyword">static</span> <a class="code" href="class_wo_r_b_1_1_g_l_u_t___framework.html" title="GLUT wrapper around a single instance of a GlutApplication template class.">WoRB::GLUT_Framework&lt;WoRB_MexFunction&gt;</a> <a class="code" href="mex_function_8cpp.html#ac74b9d22312f8540dd4e58292aca7a8b">glut</a>;
<a name="l00304"></a>00304 <span class="comment"></span>
<a name="l00305"></a>00305 <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00306"></a>00306 <span class="comment"></span><span class="comment"></span>
<a name="l00307"></a>00307 <span class="comment">/** The main entry routine for the MATLAB function WoRB.</span>
<a name="l00308"></a>00308 <span class="comment"> */</span>
<a name="l00309"></a>00309 <span class="keywordtype">void</span> <a class="code" href="mex_function_8cpp.html#ac3fe4d662ad7c0c3479bc99d78a9b41d" title="The main entry routine for the MATLAB function WoRB.">mexFunction</a>
<a name="l00310"></a><a class="code" href="mex_function_8cpp.html#ac3fe4d662ad7c0c3479bc99d78a9b41d">00310</a> (
<a name="l00311"></a>00311     <span class="keywordtype">int</span> nArgOut, mxArray* argOut[],       <span class="comment">// left-hand side (varargout) of the function</span>
<a name="l00312"></a>00312     <span class="keywordtype">int</span> nArgIn, <span class="keyword">const</span> mxArray* argIn[]    <span class="comment">// right-hand side (varargin) of the function</span>
<a name="l00313"></a>00313     )
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315     <span class="keywordflow">if</span> ( ! glut.<a class="code" href="class_wo_r_b_1_1_g_l_u_t___framework.html#a8174e3f9c2bee8f3831dea75e542913d">Initialize</a> () ) {
<a name="l00316"></a>00316         <span class="keywordflow">return</span>;
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">// Prevent clearing MEX-file from memory</span>
<a name="l00320"></a>00320     <span class="comment">//</span>
<a name="l00321"></a>00321     <span class="keywordflow">if</span> ( ! mexIsLocked () ) {
<a name="l00322"></a>00322         mexLock (); 
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="comment">// Parse mexFunction input arguments</span>
<a name="l00326"></a>00326     <span class="comment">//</span>
<a name="l00327"></a>00327     Application.<a class="code" href="class_wo_r_b___mex_function.html#a4ba3e1563aae6665affadf2f1d02c8bd" title="Initializes parameters and creates bodies from mexFunction arguments.">Parse</a>( nArgIn, argIn );
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">// </span>
<a name="l00330"></a>00330     <span class="keywordflow">if</span> ( nArgOut &gt;= 1 ) {
<a name="l00331"></a>00331         Application.<a class="code" href="class_wo_r_b___mex_function.html#afbf5725c24de78d6b99466b1e8a18a3a" title="Creates the result matrix.">CreateResultMatrix</a> ();
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     Application.<a class="code" href="class_wo_r_b___test_bed.html#ad70ed2a264312e675b3eff4768bd1406" title="Creates the GLUT window and initializes the view.">SetupAnimation</a> ();
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     glut.<a class="code" href="class_wo_r_b_1_1_g_l_u_t___framework.html#a23a48cfe20e336c99210587187c48157" title="Connects GLUT event handlers to GlutApplication instance.">Connect</a>( Application );
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     Application.<a class="code" href="class_wo_r_b___test_bed.html#aba0ad39269ed2c12748bdf08337e9710" title="Runs the simulation and rendering.">Run</a> ();
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     glut.<a class="code" href="class_wo_r_b_1_1_g_l_u_t___framework.html#a5d778d5d989d1fb82381fb943a57f46c" title="Disconect event handlers from the GlutApplication instance.">Disconnect</a> ();
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="keywordflow">if</span> ( nArgOut &gt;= 1 ) {
<a name="l00343"></a>00343         argOut[0] = Application.<a class="code" href="class_wo_r_b___mex_function.html#ac977f589a7929abe7bec2cf285bd3035" title="Gets the result matrix.">GetResult</a> ();
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345 }
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="mex_function_8cpp.html">mexFunction.cpp</a>      </li>

    <li class="footer">Generated on Sun Feb 24 2013 14:18:25 for World of Rigid Bodies (WoRB) by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
